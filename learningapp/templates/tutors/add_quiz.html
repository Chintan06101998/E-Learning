{% extends 'learningapp/base_tutor.html' %}
{% block title %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb m-1">
    <li class="breadcrumb-item fw-bold">
      <a href="{% url 'tutor-courses' %}">Course</a>
    </li>
    <li class="breadcrumb-item fw-bold active" aria-current="page">Add Quiz</li>
  </ol>
</nav>
{% endblock %}
{% block content %}
<div style="background: #c4d8f6" class="w-100">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a
              class="nav-link active"
              href="{% url 'tutor-view-course' course_id  %}"
              >Details</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link active"
              href="{% url 'tutor-view-course-material' course_id  %}"
              >Material</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="{% url 'tutor-view-course-assignments' course_id  %}"
              >Assignemnts</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="{% url 'tutor-view-course-quizzes' course_id  %}"
              >Quizzes</a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>
</div>

<head>
  <title>Create Quiz</title>
  <script>
      let totalQuestions = 1;
      let totalQuestionsLabel = 1;
      let bPrefill = false;
        // Check if the context variable oQuiz is available
        if ({{ bAdd }} == 1 ) {
          bPrefill = true;
          oQuizData = {{ oQuiz|safe }};;
        }

      function addQuestionHeader(bPrefill)
      {
        const questionsContainer = document.getElementById('question-header');

        let newQuestionHTML = ``;
        if(bPrefill && oQuizData){
          newQuestionHTML = `
                <div class="container">
                  <div class="row g-3 mb-4 align-items-center justify-content-between">
                    <div class="col-auto">
                      <h1 class="app-page-title mb-0">Update Quiz </h1>
                    </div>
                    <!--//col-auto-->
                  </div>
                <div>
                <div class="mb-3">
                  <label for="id_quiz_name" class="form-label">Quiz name:</label>
                  <input
                    type="text"
                    name="quiz_name"
                    maxlength="255"
                    class="form-control w-25"
                    id="id_quiz_name"
                    value="${oQuizData["quiz_name"]}"
                    required
                  />

                </div>

                <div class="mb-3">
                    <label for="id_duration" class="form-label"
                      >Duration:</label
                    >
                    <input
                      type="time"
                      name="duration"
                      placeholder="HH:MM:SS"
                      class="form-control w-25"
                      value="00:10:00"
                      required
                      id="id_duration"
                      step="1"
                      inputmode="numeric"
                      value="${oQuizData["duration"]}"

                    />
                  </div>
          `;
        }
        else{
          newQuestionHTML = `
                <div class="container">
                  <div class="row g-3 mb-4 align-items-center justify-content-between">
                    <div class="col-auto">
                      <h1 class="app-page-title mb-0">Add Quiz </h1>
                    </div>
                    <!--//col-auto-->
                  </div>
                <div>
                <div class="mb-3">
                  <label for="id_quiz_name" class="form-label">Quiz name:</label>
                  <input
                    type="text"
                    name="quiz_name"
                    maxlength="255"
                    class="form-control w-25"
                    id="id_quiz_name"
                    required
                  />

                </div>
{#                <p>#}
{#                  <label for="id_duration">Duration:</label>#}
{#                  <input type="text" name="duration" value="00:10:00" required="" id="id_duration">#}
{#                </p>#}
                <div class="mb-3">
                    <label for="id_duration" class="form-label"
                      >Duration:</label
                    >
                    <input
                      type="time"
                      name="duration"
                      placeholder="HH:MM:SS"
                      class="form-control w-25"
                      value="00:10:00"
                      required
                      id="id_duration"
                      step="1"
                      inputmode="numeric"

                    />
                  </div>
          `;
        }
        questionsContainer.innerHTML = newQuestionHTML;
        if(bPrefill && oQuizData)
        {
          let lstQuestion = oQuizData['lstQuestion'];
          for(let i = 0; i < lstQuestion.length; i++)
          {
            let Que = lstQuestion[i]
            let correctAnswer = 1;
            for(let j=0; j <= Que["lstOptions"].length; j++)
            {
              if(Que["lstOptions"][i].is_correct)
              {
                correctAnswer = j+1;
                break;
              }
            }
            Que["correctAnswer"] = "option"+correctAnswer;
            addQuestion(Que);
          }
        }else{
          addQuestion(null);
        }
      }
      function deleteQuestion(id)
      {
          let btn = document.getElementById(id);
          let element = btn.parentElement;
          let parent = element.parentElement;
          parent.parentElement.removeChild(parent);
          totalQuestionsLabel = totalQuestionsLabel - 1;
      }
    function addQuestion(oQuestion) {
      const questionsContainer = document.getElementById('questions-container');

      let newQuestionHTML = ``;
      if(oQuestion)
      {
         newQuestionHTML = `
            <div>
                <div class="row g-3 mb-4 align-items-center justify-content-between">
                    <div class="col-auto">
                      <h1 class="app-page-title mb-0">Question ${totalQuestionsLabel}</h1>
                    </div>
                    <!--//col-auto-->
              </div>
            <div class="mb-3">
              <label for="id_questions-question-${totalQuestions}" class="form-label">Question:</label>
              <input
                type="text"
                name="q-question-${totalQuestions}"
                maxlength="255"
                class="form-control"
                id="id_name"
                value="${oQuestion["question_text"]}"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option1-${totalQuestions}" class="form-label">Option 1:</label>
              <input
                type="text"
                name="q-option1-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                value="${oQuestion['lstOptions'][0]["option_text"]}"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option2-${totalQuestions}" class="form-label">Option 2:</label>
              <input
                type="text"
                name="q-option2-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                value="${oQuestion['lstOptions'][1]["option_text"]}"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option3-${totalQuestions}" class="form-label">Option 3:</label>
              <input
                type="text"
                name="q-option3-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                value="${oQuestion['lstOptions'][2]["option_text"]}"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option4-${totalQuestions}" class="form-label">Option 4:</label>
              <input
                type="text"
                name="q-option4-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                value="${oQuestion['lstOptions'][3]["option_text"]}"
                required
              />
            </div>
            <div class="mb-3">
              <label for="id_questions-answer${totalQuestions}"class="form-label" >Select Correct Option:</label>
              <select name="q-answer-${totalQuestions}" class="form-select w-25" value="${oQuestion['correctAnswer']}" required>
                <option value="option1">Option 1</option>
                <option value="option2">Option 2</option>
                <option value="option3">Option 3</option>
                <option value="option4">Option 4</option>
              </select>
              <label for="id_questions-marks-${totalQuestions}" class="form-label mt-3 mb-3">Total marks:</label>
              <input type="number"  class="form-control w-25" name="q-marks-${totalQuestions}"  value="${oQuestion["marks"]}" min="1" required="" >
            </div>
              <button type="button" id="delbtn-${totalQuestions}" class="btn btn-danger" onclick="deleteQuestion(this.id)">Delete Question</button>
            <hr>
          </div>
        `;
      }
      else{
        newQuestionHTML = `
            <div>
                <div class="row g-3 mb-4 align-items-center justify-content-between">
                    <div class="col-auto">
                      <h1 class="app-page-title mb-0">Question ${totalQuestionsLabel}</h1>
                    </div>
                    <!--//col-auto-->
              </div>
            {#<p>#}
            {#  <label for="id_questions-question-${totalQuestions}">Question:</label>#}
            {#  <input type="text" name="q-question-${totalQuestions}" required>#}
            {#</p>#}
            <div class="mb-3">
              <label for="id_questions-question-${totalQuestions}" class="form-label">Question:</label>
              <input
                type="text"
                name="q-question-${totalQuestions}"
                maxlength="255"
                class="form-control"
                id="id_name"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option1-${totalQuestions}" class="form-label">Option 1:</label>
              <input
                type="text"
                name="q-option1-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option2-${totalQuestions}" class="form-label">Option 2:</label>
              <input
                type="text"
                name="q-option2-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option3-${totalQuestions}" class="form-label">Option 3:</label>
              <input
                type="text"
                name="q-option3-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                required
              />
            </div>
            <div class="mb-1">
              <label for="id_questions-option4-${totalQuestions}" class="form-label">Option 4:</label>
              <input
                type="text"
                name="q-option4-${totalQuestions}"
                maxlength="255"
                class="form-control w-50"
                id="id_name"
                required
              />
            </div>
            <div class="mb-3">
              <label for="id_questions-answer${totalQuestions}"class="form-label" >Select Correct Option:</label>
              <select name="q-answer-${totalQuestions}" class="form-select w-25" required>
                <option value="option1">Option 1</option>
                <option value="option2">Option 2</option>
                <option value="option3">Option 3</option>
                <option value="option4">Option 4</option>
              </select>
              <label for="id_questions-marks-${totalQuestions}" class="form-label mt-3 mb-3">Total marks:</label>
              <input type="number"  class="form-control w-25" name="q-marks-${totalQuestions}"  min="1" required="" >
            </div>
              <button type="button" id="delbtn-${totalQuestions}" class="btn btn-danger" onclick="deleteQuestion(this.id)">Delete Question</button>
            <hr>
          </div>
        `;
      }

      const div = document.createElement('div');
      div.innerHTML = newQuestionHTML;
      questionsContainer.appendChild(div);
      totalQuestions = totalQuestions + 1;
      totalQuestionsLabel = totalQuestionsLabel + 1;
    }
  </script>
</head>
<body>
<div class="m-5">
    {% if bAdd == 0 %}
  <form method="post" action="{% url 'tutor_add_quiz' course_id%}">
{% else %}
  <form method="post" action="{% url 'tutor_update_quiz' quiz_id %}">
{% endif %}
    {% csrf_token %}
    <div id='question-header'></div>
    <div id="questions-container"></div>
    <script> addQuestionHeader(bPrefill);</script>
    <button type="button" class="btn btn-primary" onclick="addQuestion(null)">Add Question</button>
    <button type="submit" class="btn btn-success">Save Changes</button>
  </form>
</div>

</body>
{% endblock %}