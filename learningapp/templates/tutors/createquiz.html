{% extends 'learningapp/base_tutor.html' %} {% block content %}

<div class="container-xl pt-3 p-md-3 p-lg-4">
    <div class="" style="height: calc(100vh - 120px)">
      <h1 class="app-page-title">  {% if  quiz.name %} Update {% else %} Create {% endif %} Quiz</h1>
  
      <div class="app-card app-card-settings shadow-sm p-4">
        <div class="app-card-body">
            
<form method="post">
    {% csrf_token %}
    <label for="quiz_name">Quiz Name:</label>
    <input
      type="text"
      name="quiz_name"
      id="quiz_name"
      value="{{ quiz.name }}"
      required
      class="form-control"
   
    />
    <br />
    <label for="quiz_description">Quiz Description:</label>
    <textarea name="quiz_description"  class="form-control" id="quiz_description" required>
  {{ quiz.description }}</textarea
    >
    <br />
    <label for="num_questions">Number of Questions:</label>
    <input
     class="form-control"
      type="number"
      name="num_questions"
      id="num_questions"
      value="{{ quiz_questions_count }}"
      required
    />
    <br />
  
    <div id="questions-container">
      <!-- Questions and Options will be dynamically added here -->
    </div>
  
    <button type="submit" class="btn app-btn-primary w-100">
        {% if quiz.name %} Update {% else %} Create {% endif %} Quiz
        </button>
  </form>
        </div>
    </div>
</div>

<script>
    let serializedQuestions = []
    if("{{ serialized_quiz_questions|escapejs|safe }}"){
         serializedQuestions = JSON.parse(
            "{{ serialized_quiz_questions|escapejs|safe }}"
          );
        
    }

  // JavaScript c ode to handle dynamic form generation based on num_questions
  console.log(serializedQuestions);
  const questionsContainer = document.getElementById("questions-container");
  const numQuestionsInput = document.getElementById("num_questions");
  const options = ["Option 1", "Option 2", "Option 3", "Option 4"];

  for (let i = 1; i <= serializedQuestions.length; i++) {
    const questionDiv = document.createElement("div");
    questionDiv.classList.add("question");

    questionDiv.innerHTML = `
        <h2>Question ${i}</h2>
        <label for="question_${i}">Question:</label>
        <textarea  class="form-control" name="question_${i}" id="question_${i}" required>${serializedQuestions[i-1].question}</textarea>
        <br>
      `;

    // Add options for the question
    for (let j = 1; j <= options.length; j++) {
      questionDiv.innerHTML += `
    <div class='col-6'>
          <label for="option${j}_${i}">${options[j - 1]}:</label>
          <input  class="form-control" type="text" name="option${j}_${i}" id="option${j}_${i}" value="${serializedQuestions[i-1]['option'+j]}" required/>
    </div>
        `;
    }


 
    // Add the correct option select
    questionDiv.innerHTML += `
        <label for="correct_option_${i}">Correct Option:</label>
        <select class="form-control w-100" name="correct_option_${i}" id="correct_option_${i}" required>
          <option value="1" ${serializedQuestions[i-1].correct_option==="1" ?'selected':''}>Option 1</option>
          <option value="2" ${serializedQuestions[i-1].correct_option==="2" ?'selected':''}>Option 2</option>
          <option value="3" ${serializedQuestions[i-1].correct_option==="3" ?'selected':''}>Option 3</option>
          <option value="4" ${serializedQuestions[i-1].correct_option==="4" ?'selected':''}>Option 4</option>
        </select>
        <br>
      `;
    questionDiv.innerHTML += `
      <label for="marks_${i}">Marks:</label>
      <input type="number" class="form-control" name="marks_${i}" id="marks_${i}" value="${serializedQuestions[i-1].marks}" required>
      <br>
    `;
    questionsContainer.appendChild(questionDiv);
  }

  numQuestionsInput.addEventListener("input", () => {

    const numQuestions = parseInt(numQuestionsInput.value);
console.log(numQuestions)
    questionsContainer.innerHTML = "";

    for (let i = 1; i <= numQuestions; i++) {
      const questionDiv = document.createElement("div");
      questionDiv.classList.add("question");

      questionDiv.innerHTML = `
          <h2>Question ${i}</h2>
          <label for="question_${i}">Question:</label>
          <textarea class="form-control" name="question_${i}" id="question_${i}" required></textarea>
          <br>
        `;

      // Add options for the question
      for (let j = 1; j <= options.length; j++) {
        questionDiv.innerHTML += `
            <label for="option${j}_${i}">${options[j - 1]}:</label>
            <input class="form-control" type="text" name="option${j}_${i}" id="option${j}_${i}" required>
            <br>
          `;
      }

      // Add the correct option select
      questionDiv.innerHTML += `
          <label for="correct_option_${i}">Correct Option:</label>
          <select class="form-control" name="correct_option_${i}" id="correct_option_${i}" required>
            <option value="1">Option 1</option>
            <option value="2">Option 2</option>
            <option value="3">Option 3</option>
            <option value="4">Option 4</option>
          </select>
          <br>
        `;
      questionDiv.innerHTML += `
        <label for="marks_${i}">Marks:</label>
        <input class="form-control" type="number" name="marks_${i}" id="marks_${i}" required>
        <br>
      `;
      questionsContainer.appendChild(questionDiv);
    }
  });
</script>
{% endblock %}
